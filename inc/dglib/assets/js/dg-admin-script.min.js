/*!
 * Admin script of dglib
 * @package dineshghimire
 * @subpackage dglib
 */
!function(v){"use strict";var l,g=v(document);(l={Repeater:function(){var f=function(e){e.find("[name]").each(function(){v(this).trigger("change")})},t=function(){var e=v(".dg-repeater");e.sortable({orientation:"vertical",items:"> .dg-widget-repeater-table",placeholder:"dg-sortable-placeholder",update:function(e,i){f(i.item)}}),e.trigger("sortupdate"),e.sortable("refresh")};g.on("widget-added widget-updated panelsopen",function(e,i){t()}),v(function(){"widgets"===window.pagenow&&v(".widgets-holder-wrap:not(#available-widgets)").find("div.widget").one("click.toggle-widget-expanded",function(){t()})}),g.on("click",".dg-add-repeater",function(e){e.preventDefault();var i=v(this),t=i.closest(".dg-repeater"),a=t.find(".dg-code-for-repeater"),n=t.find(".dg-total-repeater-counter"),o=parseInt(n.val()),r=a.html();n.val(o+1);var d,s,c,l,g=(d=r,s=i.attr("id"),c=o,l=new RegExp(s,"g"),d.replace(l,c));i.before(v('<div class="dg-widget-repeater-table"></div>').append(g));var p=i.prev(".dg-widget-repeater-table");p.find(".dg-repeater-inside").slideDown("fast",function(){p.addClass("open"),f(p)})}),g.on("click",".dg-repeater-top, .dg-repeater-close",function(e){e.preventDefault();var i=v(this).closest(".dg-widget-repeater-table"),t=i.find(".dg-repeater-inside");t.is(":hidden")?t.slideDown("fast",function(){i.addClass("open")}):t.slideUp("fast",function(){i.removeClass("open")})}),g.on("click",".dg-repeater-remove",function(e){e.preventDefault();var i=v(this),t=i.closest(".dg-widget-repeater-table"),a=i.closest(".dg-repeater");t.remove(),a.closest("form").trigger("change"),f(a)}),g.on("change",".dg-select",function(e){e.preventDefault();var i=v(this),t=i.closest(".dg-repeater-inside"),a=t.find(".dg-postid"),n=t.find(".dg-repeater-control-actions"),o=i.find("option:selected").val();0==o?a.remove():(a.remove(),v.ajax({type:"GET",data:{action:"teg_get_edit_post_link",id:o},url:ajaxurl,beforeSend:function(e,i){a.remove()},success:function(e){0!=e&&n.append(e)},error:function(e,i,t){console.log(e+" :: "+i+" :: "+t)}}))})},Snipits:{Variables:function(){v(window).width(),v(window).height()},Color_Picker:function(t){var e={change:function(e,i){t.closest("form").trigger("change")}};t.wpColorPicker(e)},ImageUpload:function(e){e.preventDefault();var i=v(this).data("title"),t=v(this).data("button"),a=v(this).prev(),n=v(this).prev().prev().children("img"),o=v(this).siblings(".img-preview-wrap"),r=wp.media.frames.meta_image_frame=wp.media({title:i,button:{text:t},library:{type:"image"}});r.open(),r.on("select",function(){var e=r.state().get("selection").first().toJSON();a.val(e.url),null!=n&&(n.attr("src",e.url),o.show()),a.trigger("change")})},WidgetTab:function(e){var i,t;v(this).hasClass("nav-tab-active")||(t=v(this).data("id"),i=v(this).closest(".dg-widget-field-tab-wraper"),v(this).addClass("nav-tab-active").siblings(".nav-tab").removeClass("nav-tab-active"),i.find(".dg-tab-contents").removeClass("dg-tab-active"),i.find(t).addClass("dg-tab-active"))},Widget_Accordion:function(){var e=v(this).closest(".dg-accordion-title");v(this).prop("checked")?(e.siblings(".dg-accordion-content").slideDown().removeClass("open close"),e.find(".dg-accordion-arrow").addClass("fa-angle-up").removeClass("fa-angle-down")):(e.siblings(".dg-accordion-content").slideUp().removeClass("open close"),e.find(".dg-accordion-arrow").addClass("fa-angle-down").removeClass("fa-angle-up"))},Widget_Relation_Action:function(e,i,t){var a=e.val();for(var n in"CHECKBOX"==e.prop("tagName")&&(a=e.is(":checkbox")&&e.is(":checked")?a:""),i){if("empty"==t||"exist"==t)a=t;else if("values"==t&&n!=a)continue;var o=i[n];for(var r in o){var d="."+o[r].join(", .");switch(r){case"show_fields":e.closest(".widget-content").find(d).removeClass("dg-hidden-field");break;case"hide_fields":e.closest(".widget-content").find(d).addClass("dg-hidden-field");break;default:console.warn("Action "+n+" case is not defined")}}}},Widget_Relation:function(e){var i=v(this),t=i.val();"CHECKBOX"==i.prop("tagName")&&(t=i.is(":checkbox")&&i.is(":checked")?t:"");var a=v(this).data("relations");if(a){var n=l.Snipits.Widget_Relation_Action;for(var o in a){var r=a[o];if(r)switch(o){case"exist":t&&n(i,{exist:r},o);break;case"empty":t||n(i,{empty:r},o);break;case"values":r&&n(i,r,o);break;default:console.warn("Relation key "+o+"is not found.")}}}},CustomizerIcons:function(){var e=v(this),i=e.closest(".dg-icons-wrapper"),t=e.children("i").attr("class"),a=t.split(" ")[1];e.siblings().removeClass("selected"),e.addClass("selected"),i.find(".dg-icon-value").val(a),i.find(".dg-icon-preview").html('<i class="'+t+'"></i>'),i.find(".dg-icon-value").trigger("change")},IconToggle:function(){var e=v(this).closest(".dg-icons-wrapper"),i=e.find(".icons-list-wrapper"),t=e.find(".dashicons");i.is(":hidden")?(i.slideDown(),t.removeClass("dashicons-arrow-down"),t.addClass("dashicons-arrow-up")):(i.slideUp(),t.addClass("dashicons-arrow-down"),t.removeClass("dashicons-arrow-up"))},RemoveIcon:function(){var e=v(this).closest(".dg-icons-wrapper"),i=e.find(".icons-list-wrapper");e.find(".dg-icon-value").val(""),e.find(".dg-icon-preview").html(""),i.find(".single-icon").removeClass("selected")},IconSearch:function(){var e=v(this),i=this.value;e.closest(".dg-icons-wrapper").find(".icons-list-wrapper").find("i").each(function(){-1<v(this).attr("class").search(i)?v(this).parent(".single-icon").show():v(this).parent(".single-icon").hide()})},Widget_Change:function(e,i){var t=l.Snipits,a=v(i);a.find(".dg_widget_field_relation").trigger("change"),t.Color_Picker(a.find(".dg-color-picker")),a.hasClass("widget-dirty")&&(a.removeClass("widget-dirty"),a.find('input[type="submit"]').attr("disabled","disabled"))}},Click:function(){var e=l.Snipits,i=e.ImageUpload;g.on("click",".media-image-upload",i);var t=e.WidgetTab;g.on("click",".dg-widget-tab-list .nav-tab",t);var a=e.Widget_Relation;v(document).on("change",".dg_widget_field_relation",a),v(".dg_widget_field_relation").trigger("change"),g.on("click",".media-image-remove",function(e){v(this).siblings(".img-preview-wrap").hide(),v(this).prev().prev().val("")});var n=e.CustomizerIcons;g.on("click",".dg-icons-wrapper .single-icon",n);var o=e.IconToggle;g.on("click",".dg-icons-wrapper .icon-toggle, .dg-icons-wrapper .dg-icon-preview",o);var r=e.RemoveIcon;g.on("click",".dg-icons-wrapper .remove-icon",r);var d=e.IconSearch;g.on("keyup",".dg-icons-wrapper .icon-search",d);var s=e.Widget_Accordion;g.on("change",".dg-accordion-title input",s);var c=e.Widget_Change;g.on("widget-added widget-updated panelsopen",c)},Ready:function(){var e=l,i=e.Snipits;e.Repeater(),i.Variables(),i.Color_Picker(v(".dg-color-picker")),e.Click()},Load:function(){},Resize:function(){},Scroll:function(){},Init:function(){var e=l,i=e.Ready,t=e.Load,a=e.Resize,n=e.Scroll;v(document).ready(i),v(window).load(t),v(window).scroll(n),v(window).resize(a)}}).Init()}(jQuery);